#!/bin/bash

# npxのパスを探す
dir_ar=()
dir_ar+=( ~/.nodenv/shims )
dir_ar+=( /usr/local/bin )
dir_ar+=( ~/.anyenv/envs/nodenv/shims )
dir_ar+=( ~/.asdf/shims )
dir=""
for folder in ${dir_ar[@]}; do
  (type "${folder}/npx" > /dev/null 2>&1) && dir="${folder}" && break
done
[[ -z ${dir} ]] && IFS=',' && echo "no npx was found on any of ( ${dir_ar[*]} )." && exit 1

# NOTE: `sed 's|　|\\　|g'` の目的＝ファイル名に含まれる半角スペースを "\ "に変換する。
FILES=$(git ls-files| sed 's| |\\ |g')
if [ -z "$FILES" ];
  exit 0
fi

echo -e "FILES:"
i=0; for f in ${FILES}; do echo -n " $i:$f"; i=$(expr $i + 1); done
#echo -e "$FILES" | xargs -t ${dir}/npx secretlint
${dir}/npx secretlint echo -e "$FILES"

# npx結果
RET=$?
if [ $RET -eq 0 ]; then
  echo -e "\nGOOD!👍 secretlint passed successfully."
  exit 0
else
  exit 1
fi
