#!/bin/bash

# npxã®ãƒ‘ã‚¹ã‚’æ¢ã™
dir_ar=()
dir_ar+=( ~/.nodenv/shims )
dir_ar+=( /usr/local/bin )
dir_ar+=( ~/.anyenv/envs/nodenv/shims )
dir_ar+=( ~/.asdf/shims )
dir=""
for folder in ${dir_ar[@]}; do
  (type "${folder}/npx" > /dev/null 2>&1) && dir="${folder}" && break
done
[[ -z ${dir} ]] && IFS=',' && echo "no npx was found on any of ( ${dir_ar[*]} )." && exit 1

# NOTE: `sed 's|ã€€|\\ã€€|g'` ã®ç›®çš„ï¼ãƒ•ã‚¡ã‚¤ãƒ«åã«å«ã¾ã‚Œã‚‹åŠè§’ã‚¹ãƒšãƒ¼ã‚¹ã‚’ "\ "ã«å¤‰æ›ã™ã‚‹ã€‚
FILES=$(git ls-files| sed 's| |\\ |g')
if [ -z "$FILES" ];
  exit 0
fi

echo -e "FILES:"
i=0; for f in ${FILES}; do echo -n " $i:$f"; i=$(expr $i + 1); done
#echo -e "$FILES" | xargs -t ${dir}/npx secretlint
${dir}/npx secretlint echo -e "$FILES"

# npxçµæœ
RET=$?
if [ $RET -eq 0 ]; then
  echo -e "\nGOOD!ğŸ‘ secretlint passed successfully."
  exit 0
else
  exit 1
fi
