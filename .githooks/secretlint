#!/bin/bash
npx_path_candidates=()
npx_path_candidates+=( ~/.nodenv/shims )
npx_path_candidates+=( /usr/local/bin )
npx_path_candidates+=( ~/.anyenv/envs/nodenv/shims )
npx_path_candidates+=( ~/.asdf/shims )

npx_path=""
for folder in ${npx_path_candidates[@]}; do
  (type "${folder}/npx" > /dev/null 2>&1) && npx_path="${folder}" && break
done

FILES=$(git diff --cached --name-only --diff-filter=ACMR | sed 's| |\\ |g')

[ -z "$FILES" ] && exit 0
echo -e "FILES TO BE CHECKED:"
i=0; for f in ${FILES}; do
  echo -e " ($i) $f"; i=$(expr $i + 1)
done
echo -e "$FILES" | xargs -t ${npx_path}/npx secretlint

RET=$?
if [ $RET -eq 0 ]; then
  echo "GOOD!üëç No sensitive information was detected."
  exit 0
else
  echo "Whoomüç£ :Sensitive information was detected."
  exit 1
fi
