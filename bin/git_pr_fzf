#!/bin/bash

_ME=$( [ -L $0 ] && basename $(readlink $0) || basename $0)
hash=$1
_FZF_PROMPT="$_ME (commit hash = $hash)> "
_FZF_HEADER="Pull Requestを指定し 次の操作を選択して下さい。
次に選択できる操作：enter:neovim でPRを見る。 tab:ブラウザでPRを開く。"
git_search_pr_by_hash "${hash}"| \
  fzf --no-sort --prompt="${_FZF_PROMPT}" --header="${_FZF_HEADER}" --delimiter='\t' \
  --bind "enter:execute(echo '# commit hash: ${hash} に関するpull request です。
- No: ['{1}']
- State: ['{2}']
- Author: ['{3}']
- Title: ['{4}']
- Created_at: ['{7}']
- Updated_at: ['{8}']
- Closed_at:  ['{9}']
---------------------------------------------------

'{5}| sed -e 's/\r//g'| nvim -Ro -c \"set ft=markdown\" > /dev/tty)" \
  --bind "tab:execute(open '{6}')" \
  --bind "space:execute(open '{6}')" \
  --preview="echo '# commit hash: ${hash} に関するpull request です。
- No: ['{1}']
- State: ['{2}']
- Author: ['{3}']
- Title: ['{4}']
- Created_at: ['{7}']
- Updated_at: ['{8}']
- Closed_at:  ['{9}']
---------------------------------------------------

'{5}| bat --language=md" \
  --preview-window=75%
