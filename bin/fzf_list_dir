#!/bin/bash
_FZF_PROMPT="$(basename $0)"
FIND_TARGET=$1
READABLE_PATH=$(realpath ${FIND_TARGET/'~'/${HOME}}| sed -e "s#${HOME}#~#")

# フォルダの選択I/Fを表示する。
# プレビュー：そのフォルダ内のファイル一覧。
find -s -E ${FIND_TARGET/'~'/${HOME}} -not -regex '.*(\.DS_Store|/*.git/).*' -and \
  -type d \
  | sed -e 's#$#/#g' \
  | sed -e 's#\/\/*#\/#g' \
  | sed -e "s#^${HOME}#~#" \
  | fzf +m \
  --prompt="${_FZF_PROMPT} (dir=${READABLE_PATH})> " \
  --preview 'echo -n $(cd $(echo {}| sed -e "s#^~#${HOME}#"); pwd); echo '/'; echo; ls -UlaFG $(echo {}| sed -e "s#^~#${HOME}#")' \
  --preview-window=right:60%:wrap || echo $FIND_TARGET

