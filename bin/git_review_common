#!/bin/bash
! $(set -x; is_git_repo) && echo "Not a git repository." && exit 1

commit1=$1
CURRENT_BRANCH=$(set -x; git_branch_current)
review_json=$(set -x; git_get_review_json "${CURRENT_BRANCH}" "${commit1}")
BASE_BRANCH=$(echo "${review_json}"| jq -r '.base')
[[ "${BASE_BRANCH}" == "" ]] && echo "BASE_BRANCH empty. Bye" && exit 1
BASE_BRANCH=origin/${BASE_BRANCH}
merge_base_hash=$(git rev-parse --short "$(git merge-base ${BASE_BRANCH} HEAD)")
merge_base_log=$(git log -1 --date="format:%Y-%m-%d %H:%M:%S" --pretty="(%h) %ad %an %s" ${merge_base_hash})

export GIT_REVIEW_COMMON__BASE_BRANCH=${BASE_BRANCH}
export GIT_REVIEW_COMMON__REVIEW_JSON=$(echo "${review_json}"| jq ".merge_base=\"${merge_base_log}\"")
