#!/bin/bash

to_url_encoded_params() { local str=""; for arg in "$@"; do str+=" ${arg}"; done; echo "${str}"| sed -e 's/^[ ]//'| xargs -I {} url_encode "{}"; }
AUTHZ_TOKEN=$(cat ~/.config/hub| grep "oauth_token:"| awk '{ print $2 }')
REPO=repo:$(git remote get-url origin 2> /dev/null| egrep -o "([a-zA-Z0-9+-]+)\/([a-zA-Z0-9+-]+)")
TYPE=type:pr
IS=is:open
BRANCH=head:feature/inu_2nd_gen

Q="${REPO} ${TYPE} ${IS} ${BRANCH} $@"
# 基本的にはURLエンコードする。
# ただし、コロンだけはURLエンコードしない。
# たぶんgithub APIの仕様的にそうなのであろう。
URL_ENCODED_Q=$(to_url_encoded_params "${REPO}" "${TYPE}" "${IS}" "${BRANCH}" "$@"| sed -e 's/%3A/:/g')

CMD="curl -X GET -s -H 'Authorization: token {}' https://api.github.com/search/issues?q=${URL_ENCODED_Q}"
echo "<TOKEN>"| xargs -I {} echo "${CMD}"
echo "------"
eval $(echo "${AUTHZ_TOKEN}"| xargs -I {} echo "${CMD}")
