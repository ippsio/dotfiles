#!/bin/bash
project=$(ghq list | fzf --prompt='Project >')
GHQ_ROOT=$(ghq root)
[[ -z $project ]] && return 1
dir=$(find $(ghq root) -depth 3| grep -e "^.*/${project}$")

if [[ ! -z ${TMUX} ]]; then
  repository=${dir##*/}
  session=${repository//./-}
  current_session=$(tmux list-sessions | grep 'attached' | cut -d":" -f1)

  if [[ $current_session =~ ^[0-9]+$ ]]; then
    cd $dir
    tmux rename-session $session
  else
    tmux list-sessions | cut -d":" -f1 | grep -e "^$session\$" > /dev/null
    if [[ $? != 0 ]]; then
      tmux new-session -d -c $dir -s $session
    fi
    tmux switch-client -t $session
  fi
else
  cd $dir
fi
